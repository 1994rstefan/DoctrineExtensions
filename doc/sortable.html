<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctrine Extensions 3.0.0</title>

    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic'
          rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="http://Atlantic18.github.io/DoctrineExtensions/css/theme.css" type="text/css"/>
    <link rel="stylesheet" href="http://Atlantic18.github.io/DoctrineExtensions/css/theme-fixes.css" type="text/css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
</head>
<body class="wy-body-for-nav">

    <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
            <div class="wy-side-nav-search">
                <a href="http://Atlantic18.github.io/DoctrineExtensions/" class="fa fa-home"> Doctrine Extensions 3.0.0</a>
            </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/tree.html">
                                Tree
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/translatable.html">
                                Translatable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/sluggable.html">
                                Sluggable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/timestampable.html">
                                Timestampable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/blameable.html">
                                Blameable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/loggable.html">
                                Loggable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/sortable.html">
                                Sortable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/translatable.html">
                                Translator
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/softdeleteable.html">
                                SoftDeleteable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/uploadable.html">
                                Uploadable
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/references.html">
                                References
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/reference_integrity.html">
                                ReferenceIntegrity
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://Atlantic18.github.io/DoctrineExtensions/doc/ip_traceable.html">
                                IpTraceable
                            </a>
                        </li>
                                    </ul>
            </div>
            &nbsp;
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="http://Atlantic18.github.io/DoctrineExtensions/">Doctrine Extensions 3.0.0</a>
            </nav>


                        <div class="wy-nav-content">
                <div class="rst-content">
                    <div role="main" class="document">
                        <h1 id="sortable-behavior-extension-for-doctrine2">Sortable behavior extension for Doctrine2</h1>
<p><strong>Sortable</strong> behavior will maintain a position field for ordering
entities.</p>
<p>Features:</p>
<ul>
<li>Automatic handling of position index</li>
<li>Group entity ordering by one or more fields</li>
<li>Can be nested with other behaviors</li>
<li>Annotation, Yaml and Xml mapping support for extensions</li>
</ul>
<p><strong>Note:</strong></p>
<ul>
<li>Public <a href="http://github.com/l3pp4rd/DoctrineExtensions" title="Sortable extension on Github">Sortable repository</a> is available on github</li>
<li>Last update date: <strong>2012-01-02</strong></li>
</ul>
<p><strong>Portability:</strong></p>
<ul>
<li><strong>Sortable</strong> is now available as <a href="http://github.com/stof/StofDoctrineExtensionsBundle">Bundle</a>
ported to <strong>Symfony2</strong> by <strong>Christophe Coevoet</strong>, together with all other extensions</li>
</ul>
<p>This article will cover the basic installation and functionality of <strong>Sortable</strong>
behavior</p>
<p>Content:</p>
<ul>
<li><a href="#including-extension">Including</a> the extension</li>
<li>Entity <a href="#entity-mapping">example</a></li>
<li><a href="#yaml-mapping">Yaml</a> mapping example</li>
<li><a href="#xml-mapping">Xml</a> mapping example</li>
<li>Basic usage <a href="#basic-examples">examples</a></li>
</ul>
<p><a name="including-extension"></a></p>
<h2 id="setup-and-autoloading">Setup and autoloading</h2>
<p>Read the <a href="http://github.com/l3pp4rd/DoctrineExtensions/blob/master/doc/annotations.html#em-setup">documentation</a>
or check the <a href="http://github.com/l3pp4rd/DoctrineExtensions/tree/master/example">example code</a>
on how to setup and use the extensions in most optimized way.</p>
<p><a name="entity-mapping"></a></p>
<h2 id="sortable-entity-example">Sortable Entity example:</h2>
<h3 id="sortable-annotations">Sortable annotations:</h3>
<ul>
<li>**@Gedmo\Mapping\Annotation\Sortable</li>
</ul>
<p><strong>Note:</strong> that Sortable interface is not necessary, except in cases there
you need to identify entity as being Sortable. The metadata is loaded only once then
cache is activated</p>
<p><strong>Note:</strong> that you should register SortableRepository (or a subclass) as the repository in the Entity
annotation to benefit from its query methods.</p>
<pre><code class="language-php">&lt;?php
namespace Entity;

use Gedmo\Mapping\Annotation as Gedmo;
use Doctrine\ORM\Mapping as ORM;

/**
 * @ORM\Table(name="items")
 * @ORM\Entity(repositoryClass="Gedmo\Sortable\Entity\Repository\SortableRepository")
 */
class Item
{
    /** @ORM\Id @ORM\GeneratedValue @ORM\Column(type="integer") */
    private $id;

    /**
     * @ORM\Column(length=64)
     */
    private $name;

    /**
     * @Gedmo\Sortable(groups={"category"})
     * @ORM\Column(type="integer")
     */
    private $position;

    /**
     * @ORM\Column(length=128)
     */
    private $category;

    public function getId()
    {
        return $this-&gt;id;
    }

    public function setName($name)
    {
        $this-&gt;name = $name;
    }

    public function getName()
    {
        return $this-&gt;name;
    }

    public function setPosition($position)
    {
        $this-&gt;position = $position;
    }

    public function getPosition()
    {
        return $this-&gt;position;
    }

    public function setCategory($category)
    {
        $this-&gt;category = $category;
    }

    public function getCategory()
    {
        return $this-&gt;category;
    }
}</code></pre>
<p><a name="yaml-mapping"></a></p>
<h2 id="yaml-mapping-example">Yaml mapping example</h2>
<p>Yaml mapped Item: <strong>/mapping/yaml/Entity.Item.dcm.yml</strong></p>
<pre><code>---
Entity\Item:
  type: entity
  table: items
  id:
    id:
      type: integer
      generator:
        strategy: AUTO
  fields:
    name:
      type: string
      length: 64
    position:
      type: integer
      gedmo:
        sortable:
          groups: [category]
    category:
      type: string
      length: 128</code></pre>
<p><a name="xml-mapping"></a></p>
<h2 id="xml-mapping-example">Xml mapping example</h2>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;doctrine-mapping xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping"
                  xmlns:gedmo="http://gediminasm.org/schemas/orm/doctrine-extensions-mapping"&gt;
    &lt;entity name="Entity\Item" table="items"&gt;
        &lt;id name="id" type="integer" column="id"&gt;
            &lt;generator strategy="AUTO"/&gt;
        &lt;/id&gt;

        &lt;field name="name" type="string" length="128"&gt;
        &lt;/field&gt;

        &lt;field name="position" type="integer"&gt;
            &lt;gedmo:sortable groups="category"/&gt;
        &lt;/field&gt;
        &lt;field name="category" type="string" length="128"/&gt;
    &lt;/entity&gt;
&lt;/doctrine-mapping&gt;</code></pre>
<p><a name="basic-examples"></a></p>
<h2 id="basic-usage-examples">Basic usage examples:</h2>
<h3 id="to-save">To save <strong>Items</strong> at the end of the sorting list simply do:</h3>
<pre><code class="language-php">&lt;?php
// By default, items are appended to the sorting list
$item1 = new Item();
$item1-&gt;setName('item 1');
$item1-&gt;setCategory('category 1');
$this-&gt;em-&gt;persist($item1);

$item2 = new Item();
$item2-&gt;setName('item 2');
$item2-&gt;setCategory('category 1');
$this-&gt;em-&gt;persist($item2);

$this-&gt;em-&gt;flush();

echo $item1-&gt;getPosition();
// prints: 0
echo $item2-&gt;getPosition();
// prints: 1</code></pre>
<h3 id="save">Save <strong>Item</strong> at a given position:</h3>
<pre><code class="language-php">&lt;?php
$item1 = new Item();
$item1-&gt;setName('item 1');
$item1-&gt;setCategory('category 1');
$this-&gt;em-&gt;persist($item1);

$item2 = new Item();
$item2-&gt;setName('item 2');
$item2-&gt;setCategory('category 1');
$this-&gt;em-&gt;persist($item2);

$item0 = new Item();
$item0-&gt;setName('item 0');
$item0-&gt;setCategory('category 1');
$item0-&gt;setPosition(0);
$this-&gt;em-&gt;persist($item0);

$this-&gt;em-&gt;flush();

$repo = $this-&gt;em-&gt;getRepository('Entity\\Item');
$items = $repo-&gt;getBySortableGroupsQuery(array('category' =&gt; 'category 1'))-&gt;getResult();
foreach ($items as $item) {
    echo "{$item-&gt;getPosition()}: {$item-&gt;getName()}\n";
}
// prints:
// 0: item 0
// 1: item 1
// 2: item 2</code></pre>
<h3 id="reordering-the-sorted-list">Reordering the sorted list:</h3>
<pre><code class="language-php">&lt;?php
$item1 = new Item();
$item1-&gt;setName('item 1');
$item1-&gt;setCategory('category 1');
$this-&gt;em-&gt;persist($item1);

$item2 = new Item();
$item2-&gt;setName('item 2');
$item2-&gt;setCategory('category 1');
$this-&gt;em-&gt;persist($item2);

$this-&gt;em-&gt;flush();

// Update the position of item2
$item2-&gt;setPosition(0);
$this-&gt;em-&gt;persist($item2);

$this-&gt;em-&gt;flush();

$repo = $this-&gt;em-&gt;getRepository('Entity\\Item');
$items = $repo-&gt;getBySortableGroupsQuery(array('category' =&gt; 'category 1'))-&gt;getResult();
foreach ($items as $item) {
    echo "{$item-&gt;getPosition()}: {$item-&gt;getName()}\n";
}
// prints:
// 0: item 2
// 1: item 1
</code></pre>
<h3 id="using-a-foreign_key--relation-as-sortablegroup">Using a foreign_key / relation as SortableGroup</h3>
<p>If you want to use a foreign key / relation as sortable group, you have to put @Gedmo\SortableGroup annotation on ManyToOne annotation:</p>
<pre><code>/**
 * @Gedmo\SortableGroup
 * @ORM\ManyToOne(targetEntity="Item", inversedBy="children")
 * @ORM\JoinColumn(referencedColumnName="id", onDelete="SET NULL")
 */
private $parent;</code></pre>
<p>To move an item at the end of the list, you can set the position to <code>-1</code>:</p>
<pre><code>$item2-&gt;setPosition(-1);</code></pre>
                    </div>

                    <footer>
                        <hr/>
                                                    <div role="contentinfo">
                                <p>
                                    Find Doctrine Extensions 3.0.0 on <a href="https://github.com/Atlantic18/DoctrineExtensions">GitHub</a>.
                                </p>
                            </div>
                                                Built with <a href="http://couscous.io/">Couscous</a> using a <a href="https://github.com/CouscousPHP/Template-ReadTheDocs">theme</a> based on <a href="https://readthedocs.org/">Read the Docs</a>.
                    </footer>

                </div>
            </div>

        </section>

    </div>

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script src="http://Atlantic18.github.io/DoctrineExtensions/js/theme.js"></script>

    <script>
        $(function() {
            // Syntax highlighting
            hljs.initHighlightingOnLoad();
        });
    </script>

</body>
</html>
